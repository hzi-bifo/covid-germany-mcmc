<?xml version="1.0" standalone="yes"?>

<!-- Generated by BEAUTi v1.10.4                                             -->
<!--       by Alexei J. Drummond, Andrew Rambaut and Marc A. Suchard         -->
<!--       Department of Computer Science, University of Auckland and        -->
<!--       Institute of Evolutionary Biology, University of Edinburgh        -->
<!--       David Geffen School of Medicine, University of California, Los Angeles-->
<!--       http://beast.community/  										 -->



<!-- 20200706
 name                 location   scale
  <chr>                   <dbl>   <dbl>
1 tmrca-p50889            0.556 0.0154 
2 tmrca-p51537            0.577 0.0151 
3 tmrca-p53314            0.471 0.0111 
4 tmrca-p54206            0.398 0.00844
5 tmrca-p58762            0.383 0.00801
6 treeModel.rootHeight    0.600 0.0227 

-->




<beast version="1.10.4">
	
                                       -->
	<taxon id="origin">
		<date value="2020.5" direction="forwards" units="years"/>
	</taxon>

	<!-- The list of taxa to be analysed (can also include dates/ages).          -->
	<!-- ntax=3591                                               -->
	<taxa id="taxa">
		<__TAXA__>
	</taxa>


	<!-- END Discrete Traits Model                                               -->


	<!-- This is a simple constant population size coalescent model              -->
	<!-- that is used to generate an initial tree for the chain.                 -->
	<constantSize id="constant" units="years">
		<populationSize>
			<parameter id="popSize" value="0.1"/>
		</populationSize>
	</constantSize>

	<newick id="startingTree" usingDates="true">
		<__STARTING_TREE__>
	</newick>

	
	<newick id="dataTree" usingDates="false" usingHeights="true">
		<__DATA_TREE__>
	</newick>
	
	<!-- Generate a tree model                                                   -->
	<treeModel id="treeModel">
		<tree idref="startingTree"/>
		<rootHeight>
			<parameter id="treeModel.rootHeight"/>
		</rootHeight>
		<nodeHeights internalNodes="true">
			<parameter id="treeModel.internalNodeHeights"/>
		</nodeHeights>
		<nodeHeights internalNodes="true" rootNode="true">
			<parameter id="treeModel.allInternalNodeHeights"/>
		</nodeHeights>
	</treeModel>

	<!-- Statistic for sum of the branch lengths of the tree (tree length)       -->
	<treeLengthStatistic id="treeLength">
		<treeModel idref="treeModel"/>
	</treeLengthStatistic>

	<!-- Statistic for time of most recent common ancestor of tree               -->
	<tmrcaStatistic id="age(root)" absolute="true">
		<treeModel idref="treeModel"/>
	</tmrcaStatistic>


	<!-- Generate a gmrfSkyGridLikelihood for the Bayesian SkyGrid process       -->
	<gmrfSkyGridLikelihood id="skygrid">
		<populationSizes>
			<!-- skygrid.logPopSize is in log units unlike other popSize                 -->
<!-- 			<parameter id="skygrid.logPopSize" dimension="40" value="1.0"/> -->
		<parameter id="skygrid.logPopSize" dimension="40" value= "1"/>		
		</populationSizes>
		<precisionParameter>
			<parameter id="skygrid.precision" value="0.9738" lower="0.0"/>
		</precisionParameter>
		
		
		<numGridPoints>
			<parameter id="skygrid.numGridPoints" value="39.0"/>
		</numGridPoints>
		<cutOff>
			<parameter id="skygrid.cutOff" value="0.75"/> <!-- 2019.75 (Oct 1) 39.17857 weeks from 2020.5 (July 2) -->
		</cutOff>
		<intervals>
			<smartTreeIntervals>
				<treeModel idref="treeModel"/>
			</smartTreeIntervals>
		</intervals>

	</gmrfSkyGridLikelihood>


	<!-- The strict clock (Uniform rates across branches)                        -->
	<strictClockBranchRates id="branchRates">
		<rate>
			<parameter id="clock.rate" value="0.00075" lower="0.0"/>
		</rate>
	</strictClockBranchRates>


	
	<!-- Likelihood for tree given sequence data                                 -->
	<approximateTreeLikelihood id="treeLikelihood" sequenceLength="29903">
		<data>
			<newick idref="dataTree" />
		</data>
		<treeModel idref="treeModel"/>
		<strictClockBranchRates idref="branchRates"/>
	</approximateTreeLikelihood>
	
	
	<constraintsTreeLikelihood id="constraintsLikelihood">
		<constraints>
			<tree idref="dataTree"/>
		</constraints>		
		<tree idref="treeModel"/>
	</constraintsTreeLikelihood>
		<!-- The strict clock (Uniform rates across branches)                        -->
	
		<!-- Define operators                                                        -->
	<operators id="operators" optimizationSchedule="log">


		<subtreeLeap size="0.05" weight="35910">
			<treeModel idref="treeModel"/>
		</subtreeLeap>

		<scaleOperator scaleFactor="0.75" weight="30">
			<parameter idref="treeModel.rootHeight"/>
		</scaleOperator>
	
		<gmrfSkygridBlockUpdateOperator scaleFactor="1.0" weight="10">
			<gmrfSkygridLikelihood idref="skygrid"/>
		</gmrfSkygridBlockUpdateOperator>
		
		<scaleOperator scaleFactor="0.75" weight="5">
			<parameter idref="skygrid.precision"/>
		</scaleOperator>
	</operators>
	

	<!-- Define MCMC                                                             -->
	<mcmc id="mcmc" chainLength="100000000" autoOptimize="true" operatorAnalysis="__NAME__.fixedRootPrior.skygrid-__DATE__.ops">
		<joint id="joint">
			<prior id="prior">
				<constraintsTreeLikelihood idref="constraintsLikelihood"/>
				
<!--
 name                 location   scale
  <chr>                   <dbl>   <dbl>
1 tmrca-p50889            0.556 0.0154 
2 tmrca-p51537            0.577 0.0151 
3 tmrca-p53314            0.471 0.0111 
4 tmrca-p54206            0.398 0.00844
5 tmrca-p58762            0.383 0.00801
6 treeModel.rootHeight    0.600 0.0227 

-->
				<laplacePrior mean="0.5557113324471411" scale="0.015375412750785926">
					<parameter idref="treeModel.rootHeight"/>
				</laplacePrior>


	
				<gammaPrior shape="0.001" scale="1000.0" offset="0.0">
					<parameter idref="skygrid.precision"/>
				</gammaPrior>
				<gmrfSkyGridLikelihood idref="skygrid"/>
				
				<strictClockBranchRates idref="branchRates"/>	
					
			</prior>
			<likelihood id="likelihood">
			
				<approximateTreeLikelihood idref="treeLikelihood" />

			</likelihood>
		</joint>
		<operators idref="operators"/>

		<!-- write log to screen                                                     -->
		<log id="screenLog" logEvery="1000">
			<column label="Joint" dp="4" width="12">
				<joint idref="joint"/>
			</column>
			<column label="Prior" dp="4" width="12">
				<prior idref="prior"/>
			</column>
			<column label="Likelihood" dp="4" width="12">
				<likelihood idref="likelihood"/>
			</column>
			<column label="age(root)" sf="6" width="12">
				<tmrcaStatistic idref="age(root)"/>
			</column>
			<column label="treeLength" sf="6" width="12">
				<treeLengthStatistic idref="treeLength"/>
			</column>
			<column label="clock.rate" sf="6" width="12">
				<parameter idref="clock.rate"/>
			</column>

		</log>

		<!-- write log to file                                                       -->
		<log id="fileLog" logEvery="1000" fileName="__NAME__.fixedRootPrior.skygrid-__DATE__.log" overwrite="false">
			<joint idref="joint"/>
			<prior idref="prior"/>
			<likelihood idref="likelihood"/>
			<parameter idref="treeModel.rootHeight"/>
			<tmrcaStatistic idref="age(root)"/>
			<treeLengthStatistic idref="treeLength"/>
			<parameter idref="clock.rate"/>

			<parameter idref="skygrid.precision"/>
			<parameter idref="skygrid.logPopSize"/>
			<parameter idref="skygrid.cutOff"/>
			<gmrfSkyGridLikelihood idref="skygrid"/>


			<strictClockBranchRates idref="branchRates"/>	
			<approximateTreeLikelihood idref="treeLikelihood" />
			
		</log>

	

		<!-- write tree log to file                                                  -->
		<logTree id="treeFileLog" logEvery="10000" nexusFormat="true" fileName="__NAME__.fixedRootPrior.skygrid-__DATE__.trees" sortTranslationTable="true">
			<treeModel idref="treeModel"/>
			<joint idref="joint"/>
			<trait name="rate" tag="rate">
				<localClockModel idref="branchRates"/>
			</trait>
			<joint idref="joint"/>

		</logTree>

		
	</mcmc>
	
	<report>
		<property name="timer">
			<mcmc idref="mcmc"/>
		</property>
	</report>
	
</beast>
